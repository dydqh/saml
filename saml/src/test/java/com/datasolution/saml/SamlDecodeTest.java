package com.datasolution.saml;

import java.io.StringReader;
import java.util.Base64;
import java.util.Base64.Decoder;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
import org.springframework.test.context.web.WebAppConfiguration;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.NodeList;
import org.xml.sax.InputSource;

import com.fasterxml.jackson.databind.deser.ValueInstantiator.Gettable;

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = { "file:src/main/webapp/WEB-INF/spring/root-context.xml",
		"file:src/main/webapp/WEB-INF/spring/appServlet/servlet-context.xml" // DispatcherServlet(web.xml에 대한 정보가필요)
})
@WebAppConfiguration
public class SamlDecodeTest {

	String SAML = "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c2FtbDJwOlJlc3BvbnNlIERlc3RpbmF0aW9uPSJodHRwczovL2E5Y2QtMjIxLTE0OC0zMC0yMjUubmdyb2suaW8vc2FtbC9sb2dpblN1Y2Nlc3MiIElEPSJpZDEwNzY3NTkxMjAwOTMwODEzOTQxNzE1NDgzIiBJc3N1ZUluc3RhbnQ9IjIwMjEtMDktMjlUMDE6MjI6MTEuMDI3WiIgVmVyc2lvbj0iMi4wIiB4bWxuczpzYW1sMnA9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpwcm90b2NvbCI+PHNhbWwyOklzc3VlciBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OmVudGl0eSIgeG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPmh0dHA6Ly93d3cub2t0YS5jb20vZXhrMjNxNXRnVVJISWxWcjU2OTY8L3NhbWwyOklzc3Vlcj48ZHM6U2lnbmF0dXJlIHhtbG5zOmRzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjIj48ZHM6U2lnbmVkSW5mbz48ZHM6Q2Fub25pY2FsaXphdGlvbk1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIvPjxkczpTaWduYXR1cmVNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGRzaWctbW9yZSNyc2Etc2hhMjU2Ii8+PGRzOlJlZmVyZW5jZSBVUkk9IiNpZDEwNzY3NTkxMjAwOTMwODEzOTQxNzE1NDgzIj48ZHM6VHJhbnNmb3Jtcz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI2VudmVsb3BlZC1zaWduYXR1cmUiLz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+PC9kczpUcmFuc2Zvcm1zPjxkczpEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyNzaGEyNTYiLz48ZHM6RGlnZXN0VmFsdWU+RlB2UGE3VjFhMzJ3N2VTemdrdlU1bWhydmoxazNjRXBndHB0bGFaN2ZCdz08L2RzOkRpZ2VzdFZhbHVlPjwvZHM6UmVmZXJlbmNlPjwvZHM6U2lnbmVkSW5mbz48ZHM6U2lnbmF0dXJlVmFsdWU+a2p0U2xQT3NWS1htcENaTmpUSmZvNnZqYmQ1cDJkNUxqSWR4NFROZURNQ1NxUU9Hc0E5aVUzQVlWRC9YSVRBYnhEUUpYbUdqVU1kTVRZMi8vS3JsSEFlNTNvY0xPTmtIUTlJOUlqQXNjMklud3NGZ3FQZ3NpTHhqRmNJNHlLT1lqOG9SbERMMVkwT2hHZGRNNVpSanVGcThjVFI0R2Jma0g5NGVUWEZFcmNuM1JPLzQ2TjE3a1piZ0t2ZDlyVFBSTk9OL1RWalZIbzhWUTNPQVFzMHREWTYySENXSEl1UzdMbjZFQ2dQR3d4YngvVkd4RTVyRmQwRWJpR1BtWjB1QTNERDZUL0hacGVmajZ3Y1daS040WXljdHlxR2Q2SXZmMVFyak1mSXZpaVU2S2hVeXpNUkRoMzNmdjZlQVBqQzRSb0RzNlljcGpiU3YrTmJ0c3AzWkJnPT08L2RzOlNpZ25hdHVyZVZhbHVlPjxkczpLZXlJbmZvPjxkczpYNTA5RGF0YT48ZHM6WDUwOUNlcnRpZmljYXRlPk1JSURyakNDQXBhZ0F3SUJBZ0lHQVh2amJNMUpNQTBHQ1NxR1NJYjNEUUVCQ3dVQU1JR1hNUXN3Q1FZRFZRUUdFd0pWVXpFVE1CRUcKQTFVRUNBd0tRMkZzYVdadmNtNXBZVEVXTUJRR0ExVUVCd3dOVTJGdUlFWnlZVzVqYVhOamJ6RU5NQXNHQTFVRUNnd0VUMnQwWVRFVQpNQklHQTFVRUN3d0xVMU5QVUhKdmRtbGtaWEl4R0RBV0JnTlZCQU1NRDI1aGRtVnlaSEpoWjI5dVltOXpjekVjTUJvR0NTcUdTSWIzCkRRRUpBUllOYVc1bWIwQnZhM1JoTG1OdmJUQWVGdzB5TVRBNU1UUXdPREk0TWpOYUZ3MHpNVEE1TVRRd09ESTVNak5hTUlHWE1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0F3S1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ3d05VMkZ1SUVaeVlXNWphWE5qYnpFTgpNQXNHQTFVRUNnd0VUMnQwWVRFVU1CSUdBMVVFQ3d3TFUxTlBVSEp2ZG1sa1pYSXhHREFXQmdOVkJBTU1EMjVoZG1WeVpISmhaMjl1ClltOXpjekVjTUJvR0NTcUdTSWIzRFFFSkFSWU5hVzVtYjBCdmEzUmhMbU52YlRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVAKQURDQ0FRb0NnZ0VCQUxCK2dhNjlEYlpreXlTOTI4V1drV0oyN0h1eEhwVVpBZWlwSWo4b1YvN2RwUk5wR1hoQThyMTE2cDB3dytIRApLVFhQUmdoanZWekd5M2VQM2dvVVF3bmZRdElWVUpCVGh1UG4vQnZtOW43cUdxeGFaWFNvNVhCZlhsZlVUYU56dzRZWkJGRHV6N1Q3CjUrZENFV1p6YXJTU3hsekl2b042N3hDUE5JRnN2VmRlK1IvdWl5TzhKSmF3QXhDbENreXAzeFNDdnZxbzBUY0hvdFdubjUzZDk2Q20KazlvN2Y1UUw3K0c3anJWK3dnZm5uWnE3NWFaTmhyMkJNQktZbkJnTjY2eUJjeDRHakp1Ri9SQ08rNksvYUhjZHR2M0xuSjN5T1IvMwpQR0hFaW1DSmRJMUlpV08raS80NEt5YzFFN2hRVytrY3hoUUhiUHNMZGMxOHZKeWg1VmNDQXdFQUFUQU5CZ2txaGtpRzl3MEJBUXNGCkFBT0NBUUVBaHlIb1dNZjMxa3dIbGVERksyWjBTMUFLc2orVTV3MEVPOVNHeU1qa0p6MHU0TldUUFMzUlpYVWlRNmllcU9tMVpwVEIKM3A4dUxhR20rRFV5UjFqL20rSkFEZUpNVEgrZ2NWazRUd3Z0cUdETFMzZ0VmSHpINVovU2ZoUU56aS9ORmtrMVphNDQ0UjRNZnZ4YQovN3UzS0ZkVkswMU56bTZxNlVQekV3MXJyNWRvamNFUVpxS3gydVh3aWQxRVdLOGdFWjF2OUJBWCtpVThsYnpXYWhDTWt0ZXRISWo3CmROZmdQVG9YcDJRSzJmaW1rdkZpR2o1VUVtMTR0eXNkeG9ETVJGM3Q3UlNhakZ4MWR3NkVQY21IZDQzUUV0czlOdnBvR1ZhU0QwMnEKbHBuK3hTU1pVRStkWVpZSkp5MVQyUnNYdEdTNm9iK2cyanlhMHJzSnhJUU1wdz09PC9kczpYNTA5Q2VydGlmaWNhdGU+PC9kczpYNTA5RGF0YT48L2RzOktleUluZm8+PC9kczpTaWduYXR1cmU+PHNhbWwycDpTdGF0dXMgeG1sbnM6c2FtbDJwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiPjxzYW1sMnA6U3RhdHVzQ29kZSBWYWx1ZT0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnN0YXR1czpTdWNjZXNzIi8+PC9zYW1sMnA6U3RhdHVzPjxzYW1sMjpBc3NlcnRpb24gSUQ9ImlkMTA3Njc1OTEyMDEwMjQ4NTUyMDYxNjIxNjYiIElzc3VlSW5zdGFudD0iMjAyMS0wOS0yOVQwMToyMjoxMS4wMjdaIiBWZXJzaW9uPSIyLjAiIHhtbG5zOnNhbWwyPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIj48c2FtbDI6SXNzdWVyIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6ZW50aXR5IiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiI+aHR0cDovL3d3dy5va3RhLmNvbS9leGsyM3E1dGdVUkhJbFZyNTY5Njwvc2FtbDI6SXNzdWVyPjxkczpTaWduYXR1cmUgeG1sbnM6ZHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPjxkczpTaWduZWRJbmZvPjxkczpDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+PGRzOlNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZHNpZy1tb3JlI3JzYS1zaGEyNTYiLz48ZHM6UmVmZXJlbmNlIFVSST0iI2lkMTA3Njc1OTEyMDEwMjQ4NTUyMDYxNjIxNjYiPjxkczpUcmFuc2Zvcm1zPjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjZW52ZWxvcGVkLXNpZ25hdHVyZSIvPjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz48L2RzOlRyYW5zZm9ybXM+PGRzOkRpZ2VzdE1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZW5jI3NoYTI1NiIvPjxkczpEaWdlc3RWYWx1ZT5OM21HMStuZjV3NndLQWdoNlVOSXZvUlFYZXBhdHEyeE5ocFRuNWdFbFA4PTwvZHM6RGlnZXN0VmFsdWU+PC9kczpSZWZlcmVuY2U+PC9kczpTaWduZWRJbmZvPjxkczpTaWduYXR1cmVWYWx1ZT5aUWlhc0h4bGFNWEZhb3R2STVzVW5sUlNwK293VUVFeEI4QjZwUFgzeWN2MkNwRWNKc2FQOU1rK00vcURITmRNQ0NEOTFjd0JRa3lPRlh1ZTU3YkRMOHBxUXVLbmF6UkJPcnVDRFBYQjE3Nm1mRkNtUCtWa0NGdlRLRmZrazdTOWNqREF5SDFidFhYTTZDTTVBc3JoK0RTZE1kYnRYMUQvNzNSNGc4U2ZsMWZId1BwN0g0LytHMWx6M3Q3ODhlditQK0dYbnNPcTRWZDl3cTRRRkxOcmJpOFZpZVkrZUpTWGR1ZlZ0TkJwR2VUZXVjVmJISVMzOFhBUHE5NkJ2cHN4cHlISkUzTnQxamFFUlZxQk5YWlJZcVRRZEI4MlZVU1JhTFgzQVpFaFo0dEdkVnRqVzlJRzZrYzVlQU90TXo5Y2JmTnhRZEl1NnBhS29wZm1Hakk0SEE9PTwvZHM6U2lnbmF0dXJlVmFsdWU+PGRzOktleUluZm8+PGRzOlg1MDlEYXRhPjxkczpYNTA5Q2VydGlmaWNhdGU+TUlJRHJqQ0NBcGFnQXdJQkFnSUdBWHZqYk0xSk1BMEdDU3FHU0liM0RRRUJDd1VBTUlHWE1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFRwpBMVVFQ0F3S1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ3d05VMkZ1SUVaeVlXNWphWE5qYnpFTk1Bc0dBMVVFQ2d3RVQydDBZVEVVCk1CSUdBMVVFQ3d3TFUxTlBVSEp2ZG1sa1pYSXhHREFXQmdOVkJBTU1EMjVoZG1WeVpISmhaMjl1WW05emN6RWNNQm9HQ1NxR1NJYjMKRFFFSkFSWU5hVzVtYjBCdmEzUmhMbU52YlRBZUZ3MHlNVEE1TVRRd09ESTRNak5hRncwek1UQTVNVFF3T0RJNU1qTmFNSUdYTVFzdwpDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQXdLUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnd3TlUyRnVJRVp5WVc1amFYTmpiekVOCk1Bc0dBMVVFQ2d3RVQydDBZVEVVTUJJR0ExVUVDd3dMVTFOUFVISnZkbWxrWlhJeEdEQVdCZ05WQkFNTUQyNWhkbVZ5WkhKaFoyOXUKWW05emN6RWNNQm9HQ1NxR1NJYjNEUUVKQVJZTmFXNW1iMEJ2YTNSaExtTnZiVENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUApBRENDQVFvQ2dnRUJBTEIrZ2E2OURiWmt5eVM5MjhXV2tXSjI3SHV4SHBVWkFlaXBJajhvVi83ZHBSTnBHWGhBOHIxMTZwMHd3K0hECktUWFBSZ2hqdlZ6R3kzZVAzZ29VUXduZlF0SVZVSkJUaHVQbi9Cdm05bjdxR3F4YVpYU281WEJmWGxmVVRhTnp3NFlaQkZEdXo3VDcKNStkQ0VXWnphclNTeGx6SXZvTjY3eENQTklGc3ZWZGUrUi91aXlPOEpKYXdBeENsQ2t5cDN4U0N2dnFvMFRjSG90V25uNTNkOTZDbQprOW83ZjVRTDcrRzdqclYrd2dmbm5acTc1YVpOaHIyQk1CS1luQmdONjZ5QmN4NEdqSnVGL1JDTys2Sy9hSGNkdHYzTG5KM3lPUi8zClBHSEVpbUNKZEkxSWlXTytpLzQ0S3ljMUU3aFFXK2tjeGhRSGJQc0xkYzE4dkp5aDVWY0NBd0VBQVRBTkJna3Foa2lHOXcwQkFRc0YKQUFPQ0FRRUFoeUhvV01mMzFrd0hsZURGSzJaMFMxQUtzaitVNXcwRU85U0d5TWprSnowdTROV1RQUzNSWlhVaVE2aWVxT20xWnBUQgozcDh1TGFHbStEVXlSMWovbStKQURlSk1USCtnY1ZrNFR3dnRxR0RMUzNnRWZIekg1Wi9TZmhRTnppL05Ga2sxWmE0NDRSNE1mdnhhCi83dTNLRmRWSzAxTnptNnE2VVB6RXcxcnI1ZG9qY0VRWnFLeDJ1WHdpZDFFV0s4Z0VaMXY5QkFYK2lVOGxieldhaENNa3RldEhJajcKZE5mZ1BUb1hwMlFLMmZpbWt2RmlHajVVRW0xNHR5c2R4b0RNUkYzdDdSU2FqRngxZHc2RVBjbUhkNDNRRXRzOU52cG9HVmFTRDAycQpscG4reFNTWlVFK2RZWllKSnkxVDJSc1h0R1M2b2IrZzJqeWEwcnNKeElRTXB3PT08L2RzOlg1MDlDZXJ0aWZpY2F0ZT48L2RzOlg1MDlEYXRhPjwvZHM6S2V5SW5mbz48L2RzOlNpZ25hdHVyZT48c2FtbDI6U3ViamVjdCB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiI+PHNhbWwyOk5hbWVJRCBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjEuMTpuYW1laWQtZm9ybWF0OmVtYWlsQWRkcmVzcyI+ZHlkcWgyNjQ4QG5hdmVyLmNvbTwvc2FtbDI6TmFtZUlEPjxzYW1sMjpTdWJqZWN0Q29uZmlybWF0aW9uIE1ldGhvZD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmNtOmJlYXJlciI+PHNhbWwyOlN1YmplY3RDb25maXJtYXRpb25EYXRhIE5vdE9uT3JBZnRlcj0iMjAyMS0wOS0yOVQwMToyNzoxMS4wMjdaIiBSZWNpcGllbnQ9Imh0dHBzOi8vYTljZC0yMjEtMTQ4LTMwLTIyNS5uZ3Jvay5pby9zYW1sL2xvZ2luU3VjY2VzcyIvPjwvc2FtbDI6U3ViamVjdENvbmZpcm1hdGlvbj48L3NhbWwyOlN1YmplY3Q+PHNhbWwyOkNvbmRpdGlvbnMgTm90QmVmb3JlPSIyMDIxLTA5LTI5VDAxOjE3OjExLjAyN1oiIE5vdE9uT3JBZnRlcj0iMjAyMS0wOS0yOVQwMToyNzoxMS4wMjdaIiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiI+PHNhbWwyOkF1ZGllbmNlUmVzdHJpY3Rpb24+PHNhbWwyOkF1ZGllbmNlPmh0dHBzOi8vMzhmZC0yMjEtMTQ4LTMwLTIyNS5uZ3Jvay5pby9zYW1sPC9zYW1sMjpBdWRpZW5jZT48L3NhbWwyOkF1ZGllbmNlUmVzdHJpY3Rpb24+PC9zYW1sMjpDb25kaXRpb25zPjxzYW1sMjpBdXRoblN0YXRlbWVudCBBdXRobkluc3RhbnQ9IjIwMjEtMDktMjlUMDA6MDg6MzQuOTc2WiIgU2Vzc2lvbkluZGV4PSJpZDE2MzI4Nzg1MzEwMjUuMTQzNzIzMzk5NSIgeG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPjxzYW1sMjpBdXRobkNvbnRleHQ+PHNhbWwyOkF1dGhuQ29udGV4dENsYXNzUmVmPnVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphYzpjbGFzc2VzOlBhc3N3b3JkUHJvdGVjdGVkVHJhbnNwb3J0PC9zYW1sMjpBdXRobkNvbnRleHRDbGFzc1JlZj48L3NhbWwyOkF1dGhuQ29udGV4dD48L3NhbWwyOkF1dGhuU3RhdGVtZW50Pjwvc2FtbDI6QXNzZXJ0aW9uPjwvc2FtbDJwOlJlc3BvbnNlPg==";
	Decoder decoder = Base64.getDecoder();
	byte[] decodedBytes = decoder.decode(SAML.getBytes());
	String decodedSAML = new String(decodedBytes);
	
	@Test
	public void test() {
		Document doc = convertStringToXMLDocument(decodedSAML);
		System.out.println(decodedSAML);
		System.out.println(doc.getFirstChild().getNodeName());
		
		Element root = doc.getDocumentElement();
        System.out.println("Root : " + root.getTagName());
        
        NodeList list = root.getElementsByTagName("saml2:Assertion");
        System.out.println("Node List Length : " + list.getLength());
        
        Element element = (Element)list.item(0);
        String id = element.getAttribute("ID");
        System.out.println(id);
        
        String version = element.getAttribute("Version");
        System.out.println(version);
        
        NodeList list2 = root.getElementsByTagName("ds:SignedInfo");
        System.out.println("Node List Length : " + list2.getLength());
        
        Element element1 = (Element)list2.item(0);
        Element element2 = (Element)list2.item(1);
        Element element3 = (Element)list2.item(2);
        
        String version1 = element1.getAttribute("Version");
        System.out.println(version1);
        
        String version2 = element2.getAttribute("Version");
        System.out.println(version2);
        
//        String version3 = element3.getAttribute("Version");
//        System.out.println(version3);
	}
	
	private static Document convertStringToXMLDocument(String xmlString) 
    {
        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        DocumentBuilder builder = null;
        try
        {
            builder = factory.newDocumentBuilder();
            Document doc = builder.parse(new InputSource(new StringReader(xmlString)));
            return doc;
        } 
        catch (Exception e) 
        {
            e.printStackTrace();
        }
        return null;
    }
}
